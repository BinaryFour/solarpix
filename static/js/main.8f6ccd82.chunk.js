(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{122:function(e,t,a){e.exports=a(273)},273:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(53),c=a.n(o),i=a(15),l=a(6),s=a(113),u=a(114),p=a(74),m=a.n(p),d=a(280),h=a(279),f=a(9),b=a(10),g=a(12),y=a(11),v=a(13),E=a(120),O=a(7),j=a.n(O),N=a(18),w=a(117),S=a.n(w).a.create({baseURL:"http://localhost:3000"}),k=a(278),T=a(277),x=function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return(a=Object(g.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(o)))).renderInput=function(e){var t=e.label,n=e.input,o=e.meta,c="field ".concat(o.error&&o.touched?"error":"");return r.a.createElement("div",{className:c},r.a.createElement("label",null,t),r.a.createElement("input",Object.assign({},n,{autoComplete:"off"})),a.renderError(o))},a.renderDropdown=function(e,t){var n=e.label,o=e.input,c=e.meta,i="field ".concat(c.error&&c.touched?"error":"");return r.a.createElement("div",{className:i},r.a.createElement("label",null,n),r.a.createElement("select",o,r.a.createElement("option",{value:"solar"},"Solar"),r.a.createElement("option",{value:"site-audit"},"Site-Audit")),a.renderError(c))},a.onSubmit=function(e){a.props.onSubmit(e)},a}return Object(v.a)(t,e),Object(b.a)(t,[{key:"renderError",value:function(e){var t=e.error;if(e.touched&&t)return r.a.createElement("div",{className:"ui error message"},r.a.createElement("div",{className:"header"},t))}},{key:"render",value:function(){return r.a.createElement("form",{className:"ui form error",onSubmit:this.props.handleSubmit(this.onSubmit)},r.a.createElement(k.a,{name:"userName",label:"User Name",component:this.renderInput}),r.a.createElement(k.a,{name:"projectName",label:"Project Name",component:this.renderInput}),r.a.createElement(k.a,{name:"profileName",label:"Profile",component:this.renderDropdown}),r.a.createElement("br",null),r.a.createElement("button",{className:"ui button primary"},"Submit"))}}]),t}(r.a.Component),C=Object(T.a)({form:"inputForm",validate:function(e){var t={};return e.userName||(t.userName="You must enter a User Name"),e.projectName||(t.projectName="You must enter a Project Name"),e.profileName||(t.profileName="You must select a Profile"),t}})(x),A=function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(g.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r)))).state={toCategories:!1},a.onSubmit=function(e){a.props.createNewJob(e),a.setState({toCategories:!0})},a}return Object(v.a)(t,e),Object(b.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return!0===this.state.toCategories?r.a.createElement(E.a,{to:"/categories"}):r.a.createElement("div",null,r.a.createElement("h1",null,"SolarPix 2.0"),r.a.createElement(C,{onSubmit:this.onSubmit,initialValues:{profileName:"solar"}}))}}]),t}(r.a.Component),D=Object(i.b)(null,{createNewJob:function(e,t,a){return function(n){n({type:"CREATE_JOB",payload:{userName:e,projectName:t,profile:a}})}}})(A),L=a(78),I=a.n(L),_=a(275),P=function(e){function t(){return Object(f.a)(this,t),Object(g.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(b.a)(t,[{key:"renderList",value:function(e){return this.props.links.map(function(e){return r.a.createElement(_.a,{to:e.path,className:"item",key:e.id},e.label)})}},{key:"render",value:function(){var e="ui bottom fixed ".concat(this.props.links.length," item huge menu");return r.a.createElement("div",{className:e},this.renderList())}}]),t}(r.a.Component),Q=[{path:"/delete",id:"newJob",label:"New Job"}],R=function(e){function t(){return Object(f.a)(this,t),Object(g.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(b.a)(t,[{key:"componentDidMount",value:function(){try{localStorage.getItem("state").includes('"categories":{}')&&this.props.readTextFile(I.a)}catch(e){this.props.readTextFile(I.a)}}},{key:"renderList",value:function(){return this.props.categories.map(function(e){return r.a.createElement(_.a,{to:"/categories/".concat(e.id),className:"item",key:e.id},r.a.createElement("i",{className:"large middle aligned icon camera"}),r.a.createElement("div",{className:"content"},e.title,r.a.createElement("div",{style:{float:"right",marginLeft:"10px"}},"Taken Pics",r.a.createElement("div",{style:{textAlign:"center"}},e.photoQty)),r.a.createElement("div",{className:"description"},e.description)))})}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("h2",null,"Category List"),r.a.createElement("div",{className:"ui celled list",style:{marginBottom:"48px"}},this.renderList()),r.a.createElement(P,{links:Q}))}}]),t}(r.a.Component),J=Object(i.b)(function(e){return{categories:Object.values(e.categories)}},{readTextFile:function(e){return function(){var t=Object(N.a)(j.a.mark(function t(a){var n,r;return j.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],r=0,t.next=4,S.get(e);case 4:t.sent.data.split(/\n/).forEach(function(e){if(e){var t=e.split("|"),a={id:r,title:t[0],description:t[1],photoQty:0,photoQueue:[]};n.push(a),r+=1}}),a({type:"READ_TXT_FILE",payload:n});case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}})(R),F=new(a(118).a)("empowerDb");F.version(1).stores({photoDb:"photoId, uploadStatus"});var G=F,U={display:"none"},M=function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(g.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r)))).handleImage=function(e){a.props.onSubmit(e.target.files[0])},a}return Object(v.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"ui labeled big input"},r.a.createElement("input",{className:"inputfile",id:"file",onChange:this.handleImage,type:"file",accept:"image/*;capture=camera",style:U}),r.a.createElement("label",{className:"ui button large primary",htmlFor:"file"},"Take Photo"))}}]),t}(r.a.Component),Y=function(){var e=Object(N.a)(j.a.mark(function e(t){var a,n;return j.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"http://upload.empower-solar.com/index2.php",a={auth:{username:"upload",password:"nD2Qm9t4"},crossDomain:!0},(n=new FormData).append("upload",t),e.next=7,S.post("https://cors-anywhere.herokuapp.com/http://upload.empower-solar.com/index2.php",n,a);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),B=[{path:"/categories",id:"categoryList",label:"Back"}],V=function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(g.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r)))).state={categoryId:a.props.match.params.id,imageTitle:"",imageId:"",imageQty:"",thumbnails:[]},a.onClick=function(e){console.log("user clicked existing image: ".concat(e))},a.onAddPhoto=function(){var e=Object(N.a)(j.a.mark(function e(t){var n,r,o,c,i;return j.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=12;break}return n=a.props.formValues,r=a.state.imageQty+1,o="".concat(n.projectName,"_").concat(a.props.category.title,"_").concat(r,"_").concat(n.userName),c="".concat(a.state.categoryId,"_").concat(t.lastModified),i=new File([t],o+".jpeg",{type:t.type}),e.next=8,a.setState({imageTitle:o,imageId:c});case 8:a.saveToDb(i),Y(i).then(function(e){a.updateStatusTrue(),a.getThumbnails()}).catch(function(e){}),e.next=13;break;case 12:console.log("User cancelled image take");case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a.uploadPhoto=function(e){a.props.uploadImage(e)},a.saveToDb=function(){var e=Object(N.a)(j.a.mark(function e(t){return j.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G.photoDb.add({photoId:"".concat(a.state.imageId),fileName:a.state.imageTitle,uploadStatus:!1,photo:t});case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a.updateStatusTrue=Object(N.a)(j.a.mark(function e(){return j.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G.photoDb.update(a.state.imageId,{uploadStatus:!0});case 2:case"end":return e.stop()}},e,this)})),a.getThumbnails=Object(N.a)(j.a.mark(function e(){var t,n,r,o;return j.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Enter thumbnails, "),t=a.state.categoryId,e.next=4,G.photoDb.where("photoId").startsWith(t).count();case 4:if(!((n=e.sent)>0)){e.next=13;break}return e.next=8,G.photoDb.where("photoId").startsWith(t);case 8:return r=e.sent,e.next=11,r.toArray();case 11:o=e.sent,a.setState({thumbnails:o});case 13:a.props.updatePhotoQty(t,n),a.setState({imageQty:n});case 15:case"end":return e.stop()}},e,this)})),a}return Object(v.a)(t,e),Object(b.a)(t,[{key:"componentDidMount",value:function(){this.props.getCategory(this.state.categoryId),this.getThumbnails()}},{key:"renderList",value:function(){var e=this;return console.log(this.state.thumbnails),this.state.thumbnails.map(function(t){if(t){var a=URL.createObjectURL(t.photo);return r.a.createElement("div",{className:"item",key:t.photoId},r.a.createElement("img",{onClick:e.onClick,className:"ui small rounded centered image",src:a,alt:""}),r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"description"})))}return r.a.createElement("div",null)})}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("h2",null,this.props.category.title),r.a.createElement("h3",null,this.props.category.description),r.a.createElement(M,{onSubmit:this.onAddPhoto}),r.a.createElement("h3",null,"Photos: ",this.state.imageQty),r.a.createElement("div",{className:"ui huge horizontal selection celled list"},this.renderList()),r.a.createElement(P,{links:B}))}}]),t}(r.a.Component),X=Object(i.b)(function(e,t){return{category:Object.values(e.categories)[t.match.params.id],formValues:e.newJob.userName}},{getCategory:function(e){return function(t,a){t({type:"GET_CATEGORY",payload:a().categories[e]})}},addPhoto:function(e,t,a){return{type:"ADD_PHOTO",payload:{id:e,photoQty:t,photoQueue:a}}},updatePhotoQty:function(e,t){return{type:"UPDATE_PHOTOQTY",payload:{id:e,photoQty:t}}}})(V),H=function(e){function t(){return Object(f.a)(this,t),Object(g.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return c.a.createPortal(r.a.createElement("div",{className:"ui dimmer modals visible active"},r.a.createElement("div",{onClick:function(e){return e.stopPropagation()},className:"ui standard modal visible active"},r.a.createElement("div",{className:"header"},this.props.title),r.a.createElement("div",{className:"content"},this.props.content),r.a.createElement("div",{className:"actions"},this.props.actions))),document.querySelector("#modal"))}}]),t}(r.a.Component),q=a(276),W=function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(g.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r)))).state={cancel:!1,toPath:!1},a.resetData=Object(N.a)(j.a.mark(function e(){return j.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.props.clearLocalStorage(),console.log("Storage should be cleared: ",localStorage.getItem("state")),e.next=4,G.delete();case 4:a.setState({toPath:!0});case 5:case"end":return e.stop()}},e,this)})),a}return Object(v.a)(t,e),Object(b.a)(t,[{key:"renderActions",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{onClick:function(){return e.resetData()},className:"ui button negative"},"New Job"),r.a.createElement(_.a,{to:"/categories",className:"ui button"},"Cancel"))}},{key:"render",value:function(){var e=this;return this.state.cancel?r.a.createElement(q.a,{to:"/categories"}):this.state.toPath?r.a.createElement(q.a,{to:"/"}):r.a.createElement("div",null,"DeleteJob",r.a.createElement(H,{title:"Delete old photos?",content:"If you create a new job, you will lose all the photos you took from your previous session.  Delete photos and create a new job?",path:"/categories",actions:this.renderActions(),onDismiss:function(){return e.setState({toPath:!0})}}))}}]),t}(r.a.Component),z=Object(i.b)(null,{clearLocalStorage:function(){window.localStorage.clear();return{type:"CLEAR_LOCALSTORAGE",payload:{}}}})(W),K=function(){return r.a.createElement("div",{className:"ui container",style:{marginTop:"10px"}},r.a.createElement(d.a,null,r.a.createElement("div",null,r.a.createElement(h.a,{path:"/",exact:!0,component:D}),r.a.createElement(h.a,{path:"/categories",exact:!0,component:J}),r.a.createElement(h.a,{path:"/categories/:id",exact:!0,component:X}),r.a.createElement(h.a,{path:"/delete",exact:!0,component:z}))))},Z=a(281),$=a(16),ee={userName:null,projectName:null,profileName:null},te=a(36),ae=a(119),ne=a.n(ae),re=Object(l.combineReducers)({form:Z.a,newJob:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CREATE_JOB":return Object($.a)({},e,{userName:t.payload.userName,projectName:t.payload.projectName,profileName:t.payload.profileName});default:return e}},categories:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"READ_TXT_FILE":return Object($.a)({},e,ne.a.mapKeys(t.payload,"id"));case"ENCODE_IMAGE":case"GET_CATEGORY":return Object($.a)({},e,Object(te.a)({},t.payload.id,t.payload));case"GET_LOCALSTORAGE":return Object($.a)({},e,{categories:t.payload});case"UPDATE_PHOTOQTY":return Object($.a)({},e,Object(te.a)({},t.payload.id,Object($.a)({},e[t.payload.id],{photoQty:t.payload.photoQty})));default:return e}},uploadQueue:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"TO_UPLOAD":return Object($.a)({},e,{uploadQueue:t.payload});default:return e}},clearStorage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};switch((arguments.length>1?arguments[1]:void 0).type){case"CLEAR_LOCALSTORAGE":return Object($.a)({},e,{categories:void 0,newJob:void 0});default:return e}}}),oe=function(e,t){return"CLEAR_LOCALSTORAGE"===t.type&&(e=void 0),re(e,t)},ce=function(){try{var e=localStorage.getItem("state");if(null===e)return;return JSON.parse(e)}catch(t){return}}(),ie=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||l.compose,le=Object(l.createStore)(oe,ce,ie(Object(l.applyMiddleware)(s.a),Object(u.offline)(m.a)));le.subscribe(function(){!function(e){try{var t=JSON.stringify(e);localStorage.setItem("state",t)}catch(a){}}({newJob:le.getState().newJob,categories:le.getState().categories})}),c.a.render(r.a.createElement(i.a,{store:le},r.a.createElement(K,null)),document.querySelector("#root"))},78:function(e,t,a){e.exports=a.p+"static/media/categoryListFile.aaaad6f5.bin"}},[[122,1,2]]]);
//# sourceMappingURL=main.8f6ccd82.chunk.js.map