(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{133:function(e,t,a){e.exports=a(296)},296:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(31),c=a.n(o),i=a(15),s=a(6),l=a(122),u=a(123),p=a(78),m=a.n(p),d=a(304),h=a(302),f=a(56),b=a(9),g=a(10),y=a(12),v=a(11),E=a(13),O=a(131),j=a(7),w=a.n(j),N=a(16),S=a(127),k=a.n(S).a.create({baseURL:"https://binaryfour.github.io"}),T=a(301),x=a(300),I=function(e){function t(){var e,a;Object(b.a)(this,t);for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return(a=Object(y.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(o)))).renderInput=function(e){var t=e.label,n=e.input,o=e.meta,c="field ".concat(o.error&&o.touched?"error":"");return r.a.createElement("div",{className:c},r.a.createElement("label",null,t),r.a.createElement("input",Object.assign({},n,{autoComplete:"off"})),a.renderError(o))},a.renderDropdown=function(e,t){var n=e.label,o=e.input,c=e.meta,i="field ".concat(c.error&&c.touched?"error":"");return r.a.createElement("div",{className:i},r.a.createElement("label",null,n),r.a.createElement("select",o,r.a.createElement("option",{value:"solar"},"Solar"),r.a.createElement("option",{value:"site-audit"},"Site-Audit")),a.renderError(c))},a.onSubmit=function(e){a.props.onSubmit(e)},a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"renderError",value:function(e){var t=e.error;if(e.touched&&t)return r.a.createElement("div",{className:"ui error message"},r.a.createElement("div",{className:"header"},t))}},{key:"render",value:function(){return r.a.createElement("form",{className:"ui form error",onSubmit:this.props.handleSubmit(this.onSubmit)},r.a.createElement(T.a,{name:"userName",label:"User Name",component:this.renderInput}),r.a.createElement(T.a,{name:"projectName",label:"Project Name",component:this.renderInput}),r.a.createElement(T.a,{name:"profileName",label:"Profile",component:this.renderDropdown}),r.a.createElement("br",null),r.a.createElement("button",{className:"ui button primary"},"Submit"))}}]),t}(r.a.Component),C=Object(x.a)({form:"inputForm",validate:function(e){var t={};return e.userName||(t.userName="You must enter a User Name"),e.projectName||(t.projectName="You must enter a Project Name"),e.profileName||(t.profileName="You must select a Profile"),t}})(I),D=new(a(128).a)("empowerDb");D.version(1).stores({photoDb:"photoId, uploadStatus"});var A=D,_=function(e){function t(){var e,a;Object(b.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(y.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).state={toCategories:!1,toDelete:!1},a.onSubmit=function(e){a.props.createNewJob(e),a.setState({toCategories:!0})},a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){try{localStorage.getItem("state").includes('"categories":{}')&&!A.isOpen()||this.setState({toDelete:!0})}catch(e){console.log(e)}}},{key:"render",value:function(){return!0===this.state.toCategories?r.a.createElement(O.a,{to:"/categories"}):!0===this.state.toDelete?r.a.createElement(O.a,{to:"/delete"}):r.a.createElement("div",null,r.a.createElement("h1",null,"SolarPix 2.0"),r.a.createElement(C,{onSubmit:this.onSubmit,initialValues:{profileName:"solar"}}))}}]),t}(r.a.Component),L=Object(i.b)(null,{createNewJob:function(e,t,a){return function(n){n({type:"CREATE_JOB",payload:{userName:e,projectName:t,profile:a}})}}})(_),P=a(82),U=a.n(P),M=a(298),R=function(e){function t(){return Object(b.a)(this,t),Object(y.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(E.a)(t,e),Object(g.a)(t,[{key:"renderList",value:function(e){return this.props.links.map(function(e){return r.a.createElement(M.a,{to:e.path,className:"item",key:e.id},e.label)})}},{key:"render",value:function(){var e="ui bottom fixed ".concat(this.props.links.length," item huge menu");return r.a.createElement("div",{className:e},this.renderList())}}]),t}(r.a.Component),Q=[{path:"/delete",id:"newJob",label:"New Job"}],F=function(e){function t(){return Object(b.a)(this,t),Object(y.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(E.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){try{localStorage.getItem("state").includes('"categories":{}')&&this.props.readTextFile(U.a)}catch(e){this.props.readTextFile(U.a)}}},{key:"renderList",value:function(){return this.props.categories.map(function(e){return r.a.createElement(M.a,{to:"/categories/".concat(e.id),className:"item",key:e.id},r.a.createElement("i",{className:"large middle aligned icon camera"}),r.a.createElement("div",{className:"content"},e.title,r.a.createElement("div",{style:{float:"right",marginLeft:"10px"}},"Taken Pics",r.a.createElement("div",{style:{textAlign:"center"}},e.photoQty)),r.a.createElement("div",{className:"description"},e.description)))})}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("h2",null,"Category List"),r.a.createElement("div",{className:"ui celled list",style:{marginBottom:"48px"}},this.renderList()),r.a.createElement(R,{links:Q}))}}]),t}(r.a.Component),J=Object(i.b)(function(e){return{categories:Object.values(e.categories)}},{readTextFile:function(e){return function(){var t=Object(N.a)(w.a.mark(function t(a){var n,r;return w.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],r=0,t.next=4,k.get(e);case 4:t.sent.data.split(/\n/).forEach(function(e){if(e){var t=e.split("|"),a={id:r,title:t[0],description:t[1],photoQty:0,photoQueue:[]};n.push(a),r+=1}}),a({type:"READ_TXT_FILE",payload:n});case 8:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()}})(F),G={display:"none"},Y=function(e){function t(){var e,a;Object(b.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(y.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).handleImage=function(e){a.props.onSubmit(e.target.files[0])},a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"ui labeled big input"},r.a.createElement("input",{className:"inputfile",id:"file",onChange:this.handleImage,type:"file",accept:"image/*;capture=camera",style:G}),r.a.createElement("label",{className:"ui button large primary",htmlFor:"file"},"Take Photo"))}}]),t}(r.a.Component),B=function(){var e=Object(N.a)(w.a.mark(function e(t){var a,n;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"http://upload.empower-solar.com/index2.php",a={auth:{username:"upload",password:"nD2Qm9t4"},crossDomain:!0},(n=new FormData).append("upload",t),e.next=7,k.post("https://cors-anywhere.herokuapp.com/http://upload.empower-solar.com/index2.php",n,a);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),V=function(e){function t(){return Object(b.a)(this,t),Object(y.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(E.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return c.a.createPortal(r.a.createElement("div",{className:"ui dimmer modals visible active",style:{display:this.props.show}},r.a.createElement("div",{onClick:function(e){return e.stopPropagation()},className:"ui standard modal visible active"},r.a.createElement("div",{className:"header"},this.props.title),r.a.createElement("div",{className:"content"},this.props.content),r.a.createElement("img",{className:"ui medium rounded centered image",alt:"",src:this.props.image,style:{marginBottom:"10px"}}),r.a.createElement("div",{className:"actions"},this.props.actions))),document.querySelector("#modal"))}}]),t}(r.a.Component),W=[{path:"/categories",id:"categoryList",label:"Back"}],X=function(e){function t(){var e,a;Object(b.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(y.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r))))._isMounted=!1,a.testVar=!1,a.state={categoryId:a.props.match.params.id,image:{},showImage:"",imageTitle:"",imageId:"",imageQty:"",thumbnails:[],showModal:"none"},a.onClickThumbnail=function(){var e=Object(N.a)(w.a.mark(function e(t){var n;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=URL.createObjectURL(t.photo),e.next=3,a.setState({showModal:"",image:t.photo,showImage:n,imageId:t.photoId});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.uploadFile=function(){var e=a.state.imageId;a.toastSettings("Uploading File...","info"),B(a.state.image).then(function(t){a.toastSettings("Uploaded Image!","success"),a.updateStatusTrue(e),a._isMounted&&(a.setState({showModal:"none",image:{},showImage:"",imageId:""}),a.getThumbnails())}).catch(function(e){console.log(e),a.toastSettings("Image upload fail.  You can click on an thumbnail to re-attempt upload","error")})},a.onAddPhoto=function(){var e=Object(N.a)(w.a.mark(function e(t){var n,r,o,c,i;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.type.startsWith("image")){e.next=13;break}return n=a.props.formValues,r=a.state.imageQty+1,o="".concat(n.projectName,"_").concat(a.props.category.title,"_").concat(r,"_").concat(n.userName),c="".concat(a.state.categoryId,"_").concat(t.lastModified),i=new File([t],o+".jpeg",{type:t.type}),e.next=8,a.setState({imageTitle:o,imageId:c});case 8:try{a.saveToDb(i),a.getThumbnails()}catch(s){a.toastSettings("Screenshot this and send to your dev ".concat(s),"error")}a.toastSettings("Uploading File...","info"),B(i).then(function(e){a.toastSettings("Uploaded Image!","success"),a.updateStatusTrue(c),a._isMounted&&a.getThumbnails()}).catch(function(e){console.log(e),a.toastSettings("Image upload fail.  You can click on an thumbnail to re-attempt upload","error")}),e.next=15;break;case 13:console.log("User cancelled image take/Wrong file type"),a.toastSettings("Only images can be accepted","warning");case 15:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.saveToDb=function(){var e=Object(N.a)(w.a.mark(function e(t){return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.photoDb.add({photoId:"".concat(a.state.imageId),fileName:a.state.imageTitle,uploadStatus:!1,photo:t});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.updateStatusTrue=function(){var e=Object(N.a)(w.a.mark(function e(t){return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("UpdateStatusTrue, state w/ imageId",a.state),e.next=3,A.photoDb.update(t,{uploadStatus:!0});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.getThumbnails=Object(N.a)(w.a.mark(function e(){var t,n,r,o;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.state.categoryId,e.next=3,A.photoDb.where("photoId").startsWith(t).count();case 3:if(!((n=e.sent)>0)){e.next=12;break}return e.next=7,A.photoDb.where("photoId").startsWith(t);case 7:return r=e.sent,e.next=10,r.toArray();case 10:o=e.sent,a.setState({thumbnails:o});case 12:a.props.updatePhotoQty(t,n),a.setState({imageQty:n}),console.log(a.state.thumbnails);case 15:case"end":return e.stop()}},e)})),a.toastSettings=function(e,t){a.props.toastManager.add(e,{appearance:t,autoDismiss:!0})},a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){this._isMounted=!0,this.props.getCategory(this.state.categoryId),A.isOpen()||A.open(),this.getThumbnails()}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"renderActions",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{onClick:function(){return e.uploadFile()},className:"ui button primary"},"Upload"),r.a.createElement("button",{onClick:function(){return e.setState({showModal:"none",image:{},showImage:"",imageId:""})},className:"ui button"},"Cancel"))}},{key:"renderList",value:function(){var e=this;return this.state.thumbnails.map(function(t){if(t){var a=URL.createObjectURL(t.photo);return r.a.createElement("div",{onClick:function(a){return e.onClickThumbnail(t)},className:"item",key:t.photoId},r.a.createElement("img",{className:"ui small rounded centered image",src:a,alt:"",style:{marginBottom:"5px"}}),r.a.createElement("div",{className:"description"},t.uploadStatus?"Uploaded!":"Not Uploaded"))}return r.a.createElement("div",null)})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(V,{show:this.state.showModal,title:this.state.image.name,image:this.state.showImage,actions:this.renderActions(),onDismiss:function(){return e.setState({showModal:"none"})}}),r.a.createElement("h2",null,this.props.category.title),r.a.createElement("h3",null,this.props.category.description),r.a.createElement(Y,{onSubmit:this.onAddPhoto}),r.a.createElement("h3",null,"Photos: ",this.state.imageQty),r.a.createElement("div",{className:"ui huge horizontal selection celled list",style:{marginBottom:"60px"}},this.renderList()),r.a.createElement(R,{links:W}))}}]),t}(r.a.Component),H=Object(f.withToastManager)(X),q=Object(i.b)(function(e,t){return{category:Object.values(e.categories)[t.match.params.id],formValues:e.newJob.userName}},{getCategory:function(e){return function(t,a){t({type:"GET_CATEGORY",payload:a().categories[e]})}},addPhoto:function(e,t,a){return{type:"ADD_PHOTO",payload:{id:e,photoQty:t,photoQueue:a}}},updatePhotoQty:function(e,t){return{type:"UPDATE_PHOTOQTY",payload:{id:e,photoQty:t}}}})(H),z=a(299),K=function(e){function t(){var e,a;Object(b.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(y.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).state={cancel:!1,toPath:!1},a.resetData=Object(N.a)(w.a.mark(function e(){return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.props.clearLocalStorage(),e.next=3,A.delete();case 3:a.setState({toPath:!0});case 4:case"end":return e.stop()}},e)})),a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"renderActions",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{onClick:function(){return e.resetData()},className:"ui button negative"},"New Job"),r.a.createElement(M.a,{to:"/categories",className:"ui button"},"Cancel"))}},{key:"render",value:function(){var e=this;return this.state.cancel?r.a.createElement(z.a,{to:"/categories"}):this.state.toPath?r.a.createElement(z.a,{to:"/"}):r.a.createElement("div",null,r.a.createElement(V,{title:"Detected previous session.  Delete old photos?",content:"You have session data.  If you create a new job, you will lose all the photos you took from your previous session.  Delete photos and create a new job?",path:"/categories",actions:this.renderActions(),onDismiss:function(){return e.setState({toPath:!0})}}))}}]),t}(r.a.Component),Z=Object(i.b)(null,{clearLocalStorage:function(){return window.localStorage.clear(),{type:"CLEAR_LOCALSTORAGE",payload:{}}}})(K),$=function(){return r.a.createElement(f.ToastProvider,null,r.a.createElement("div",{className:"ui container",style:{marginTop:"10px"}},r.a.createElement(d.a,null,r.a.createElement("div",null,r.a.createElement(h.a,{path:"/",exact:!0,component:L}),r.a.createElement(h.a,{path:"/categories",exact:!0,component:J}),r.a.createElement(h.a,{path:"/categories/:id",exact:!0,component:q}),r.a.createElement(h.a,{path:"/delete",exact:!0,component:Z})))))},ee=a(303),te=a(17),ae={userName:null,projectName:null,profileName:null},ne=a(39),re=a(129),oe=a.n(re),ce=Object(s.combineReducers)({form:ee.a,newJob:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ae,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CREATE_JOB":return Object(te.a)({},e,{userName:t.payload.userName,projectName:t.payload.projectName,profileName:t.payload.profileName});default:return e}},categories:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"READ_TXT_FILE":return Object(te.a)({},e,oe.a.mapKeys(t.payload,"id"));case"ENCODE_IMAGE":case"GET_CATEGORY":return Object(te.a)({},e,Object(ne.a)({},t.payload.id,t.payload));case"GET_LOCALSTORAGE":return Object(te.a)({},e,{categories:t.payload});case"UPDATE_PHOTOQTY":return Object(te.a)({},e,Object(ne.a)({},t.payload.id,Object(te.a)({},e[t.payload.id],{photoQty:t.payload.photoQty})));default:return e}},uploadQueue:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"TO_UPLOAD":return Object(te.a)({},e,{uploadQueue:t.payload});default:return e}},clearStorage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};switch((arguments.length>1?arguments[1]:void 0).type){case"CLEAR_LOCALSTORAGE":return Object(te.a)({},e,{categories:void 0,newJob:void 0});default:return e}}}),ie=function(e,t){return"CLEAR_LOCALSTORAGE"===t.type&&(e=void 0),ce(e,t)},se=function(){try{var e=localStorage.getItem("state");if(null===e)return;return JSON.parse(e)}catch(t){return}}(),le=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||s.compose,ue=Object(s.createStore)(ie,se,le(Object(s.applyMiddleware)(l.a),Object(u.offline)(m.a)));ue.subscribe(function(){!function(e){try{var t=JSON.stringify(e);localStorage.setItem("state",t)}catch(a){}}({newJob:ue.getState().newJob,categories:ue.getState().categories})}),c.a.render(r.a.createElement(i.a,{store:ue},r.a.createElement($,null)),document.querySelector("#root"))},82:function(e,t,a){e.exports=a.p+"static/media/categoryListFile.d1a472a9.bin"}},[[133,1,2]]]);
//# sourceMappingURL=main.9baed377.chunk.js.map