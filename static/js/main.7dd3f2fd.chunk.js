(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{121:function(e,t,a){e.exports=a(272)},272:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(111),i=a.n(o),c=a(13),l=a(6),s=a(113),u=a(114),m=a(71),p=a.n(m),d=a(277),h=a(279),f=a(10),g=a(11),b=a(14),y=a(12),E=a(15),O=a(280),v=a(34),j=a.n(v),N=a(73),A=a(117),w=a.n(A).a.create({baseURL:"http://localhost:3000",withCredentials:!0,auth:{username:"upload",password:"nD2Qm9t4"}}),S=a(276),T=a(275),k=function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(b.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(o)))).renderInput=function(e){var t=e.label,n=e.input,o=e.meta,i="field ".concat(o.error&&o.touched?"error":"");return r.a.createElement("div",{className:i},r.a.createElement("label",null,t),r.a.createElement("input",Object.assign({},n,{autoComplete:"off"})),a.renderError(o))},a.renderDropdown=function(e,t){var n=e.label,o=e.input,i=e.meta,c="field ".concat(i.error&&i.touched?"error":"");return r.a.createElement("div",{className:c},r.a.createElement("label",null,n),r.a.createElement("select",o,r.a.createElement("option",{value:"solar"},"Solar"),r.a.createElement("option",{value:"site-audit"},"Site-Audit")),a.renderError(i))},a.onSubmit=function(e){a.props.onSubmit(e)},a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"renderError",value:function(e){var t=e.error;if(e.touched&&t)return r.a.createElement("div",{className:"ui error message"},r.a.createElement("div",{className:"header"},t))}},{key:"render",value:function(){return r.a.createElement("form",{className:"ui form error",onSubmit:this.props.handleSubmit(this.onSubmit)},r.a.createElement(S.a,{name:"userName",label:"User Name",component:this.renderInput}),r.a.createElement(S.a,{name:"projectName",label:"Project Name",component:this.renderInput}),r.a.createElement(S.a,{name:"profileName",label:"Profile",component:this.renderDropdown}),r.a.createElement("br",null),r.a.createElement("button",{className:"ui button primary"},"Submit"))}}]),t}(r.a.Component),C=Object(T.a)({form:"inputForm",validate:function(e){var t={};return e.userName||(t.userName="You must enter a User Name"),e.projectName||(t.projectName="You must enter a Project Name"),e.profileName||(t.profileName="You must select a Profile"),t}})(k),I=function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(b.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r)))).state={toCategories:!1},a.onSubmit=function(e){a.props.createNewJob(e),a.setState({toCategories:!0})},a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return!0===this.state.toCategories?r.a.createElement(O.a,{to:"/categories"}):r.a.createElement("div",null,r.a.createElement("h1",null,"SolarPix 2.0"),r.a.createElement(C,{onSubmit:this.onSubmit,initialValues:{profileName:"solar"}}))}}]),t}(r.a.Component),L=Object(c.b)(null,{createNewJob:function(e,t,a){return function(n){n({type:"CREATE_JOB",payload:{userName:e,projectName:t,profile:a}})}}})(I),_=a(76),D=a.n(_),Q=a(274),P=function(e){function t(){return Object(f.a)(this,t),Object(b.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(E.a)(t,e),Object(g.a)(t,[{key:"renderList",value:function(e){return this.props.links.map(function(e){return r.a.createElement(Q.a,{to:e.path,className:"item",key:e.id},e.label)})}},{key:"render",value:function(){var e="ui bottom fixed ".concat(this.props.links.length," item huge menu");return r.a.createElement("div",{className:e},this.renderList())}}]),t}(r.a.Component),x=[{path:"/",id:"newJob",label:"New Job"}],R=function(e){function t(){return Object(f.a)(this,t),Object(b.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(E.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){try{localStorage.getItem("state").includes('"categories":{}')&&this.props.readTextFile(D.a)}catch(e){this.props.readTextFile(D.a)}}},{key:"renderList",value:function(){return this.props.categories.map(function(e){return r.a.createElement(Q.a,{to:"/categories/".concat(e.id),className:"item",key:e.id},r.a.createElement("i",{className:"large middle aligned icon camera"}),r.a.createElement("div",{className:"content"},e.title,r.a.createElement("div",{className:"description"},e.description)))})}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("h2",null,"Category List"),r.a.createElement("div",{className:"ui celled list",style:{marginBottom:"48px"}},this.renderList()),r.a.createElement(P,{links:x}))}}]),t}(r.a.Component),U=Object(c.b)(function(e){return{categories:Object.values(e.categories)}},{readTextFile:function(e){return function(){var t=Object(N.a)(j.a.mark(function t(a){var n,r;return j.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],r=0,t.next=4,w.get(e);case 4:t.sent.data.split(/\n/).forEach(function(e){if(e){var t=e.split("|"),a={id:r,title:t[0],description:t[1],photoQty:0,photoQueue:[]};n.push(a),r+=1}}),a({type:"READ_TXT_FILE",payload:n});case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}})(R),J=new(a(118).a)("photoDatabase");J.version(1).stores({photoStore:"photoId, dataURL, uploadStatus"}),J.open().catch(function(e){console.error("Open failed: "+e)});var F=J,G=function(e,t){var a=new Image;a.crossOrigin="Anonymous",a.onload=function(){var e,n=document.createElement("CANVAS"),r=n.getContext("2d");n.height=a.naturalHeight,n.width=a.naturalWidth,r.drawImage(a,0,0),e=n.toDataURL("image/jpeg",.2),t(e),n=null},a.src=e,(a.complete||void 0===a.complete)&&(a.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",console.log("Image was cached, try to load again"),a.src=e)},M={display:"none"},B=function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(b.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r)))).handleImage=function(e){a.props.onSubmit(e.target.files[0])},a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"ui labeled big input"},r.a.createElement("input",{className:"inputfile",id:"file",onChange:this.handleImage,type:"file",accept:"image/*;capture=camera",style:M}),r.a.createElement("label",{className:"ui button large primary",htmlFor:"file"},"Take Photo"))}}]),t}(r.a.Component),Y=[{path:"/categories",id:"categoryList",label:"Back"}],X=function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(b.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r)))).state={imageTitle:"",imageId:"",imageQty:a.props.category.photoQty,thumbnails:[]},a.onClick=function(e){console.log("user clicked existing image: ".concat(e))},a.onAddPhoto=function(e){var t=a.state.imageQty+1,n="".concat(a.props.category.title,"_").concat(t);a.setState({imageTitle:n,imageQty:t,imageId:e.lastModified}),G(URL.createObjectURL(e),a.getPhotoUrl)},a.getPhotoUrl=function(e){var t=a.props.category.photoQueue;t.push({id:a.state.imageId,imageTitle:a.state.imageTitle,uploadStatus:!1}),a.props.addPhoto(a.props.match.params.id,a.state.imageQty,t),F.photoStore.add({photoId:a.state.imageId,dataURL:e,uploadStatus:!1}),a.getThumbnails(),a.setState({imageId:"",imageTitle:""})},a.getThumbnails=function(){console.log("entered getThumbnails");var e=a.state.thumbnails,t=a.props.category.photoQueue;F.transaction("r",F.photoStore,function(){for(var a=0;a<t.length;a++)e.push(F.photoStore.get(t[a].id));console.log("This is thumbnails after get from db: ",this.state.thumbnails)}).catch(function(e){console.log("There was an error fetching thumbnails: ",e)}),a.setState({thumbnails:e})},a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){this.props.getCategory(this.props.match.params.id);try{0===!this.props.category.photoQueue.length&&this.getThumbnails()}catch(e){}}},{key:"renderList",value:function(){var e=this;return this.state.thumbnails.map(function(t){return t?r.a.createElement("div",{className:"item",key:t.id},r.a.createElement("img",{onClick:e.onClick,className:"ui small rounded centered image",src:t.dataURL,alt:""}),r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"description"}))):r.a.createElement("div",null)})}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("h2",null,this.props.category.title),r.a.createElement("h3",null,this.props.category.description),r.a.createElement(B,{onSubmit:this.onAddPhoto}),r.a.createElement("h3",null,"Photos"),r.a.createElement("div",{className:"ui huge horizontal selection celled list"},this.renderList()),r.a.createElement(P,{links:Y}))}}]),t}(r.a.Component),H=Object(c.b)(function(e,t){return{category:Object.values(e.categories)[t.match.params.id]}},{getCategory:function(e){return function(t,a){t({type:"GET_CATEGORY",payload:a().categories[e]})}},addPhoto:function(e,t,a){return{type:"ADD_PHOTO",payload:{id:e,photoQty:t,photoQueue:a}}},toUploadQueue:function(e,t){return{type:"TO_UPLOAD",payload:{id:e,dataURL:t,uploadStatus:!1}}},uploadImage:function(e){return function(){var t=Object(N.a)(j.a.mark(function t(a,n){var r,o;return j.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(r=new FormData).append("image",e),t.next=5,w.post("https://upload.empower-solar.com",r);case 5:o=t.sent,console.log("this is the response: ",o),a({type:"UPLOAD_IMAGE",payload:o.data});case 8:case"end":return t.stop()}},t,this)}));return function(e,a){return t.apply(this,arguments)}}()}})(X),V=function(){return r.a.createElement("div",{className:"ui container",style:{marginTop:"10px"}},r.a.createElement(d.a,null,r.a.createElement("div",null,r.a.createElement(h.a,{path:"/categories",exact:!0,component:U}),r.a.createElement(h.a,{path:"/categories/:id",exact:!0,component:H}),r.a.createElement(h.a,{path:"/",exact:!0,component:L}))))},q=a(278),z=a(18),K={userName:null,projectName:null,profileName:null},W=a(35),Z=a(119),$=a.n(Z),ee=Object(l.combineReducers)({form:q.a,newJob:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CREATE_JOB":return Object(z.a)({},e,{userName:t.payload.userName,projectName:t.payload.projectName,profileName:t.payload.profileName});default:return e}},categories:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"READ_TXT_FILE":return Object(z.a)({},e,$.a.mapKeys(t.payload,"id"));case"ENCODE_IMAGE":case"GET_CATEGORY":return Object(z.a)({},e,Object(W.a)({},t.payload.id,t.payload));case"GET_LOCALSTORAGE":return Object(z.a)({},e,{categories:t.payload});case"ADD_PHOTO":return Object(z.a)({},e,Object(W.a)({},t.payload.id,Object(z.a)({},e[t.payload.id],{photoQty:t.payload.photoQty,photoQueue:t.payload.photoQueue})));default:return e}},uploadQueue:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"TO_UPLOAD":return Object(z.a)({},e,{uploadQueue:t.payload});default:return e}}}),te=function(){try{var e=localStorage.getItem("state");if(null===e)return;return JSON.parse(e)}catch(t){return}}(),ae=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||l.compose,ne=Object(l.createStore)(ee,te,ae(Object(l.applyMiddleware)(s.a),Object(u.offline)(p.a)));ne.subscribe(function(){!function(e){try{var t=JSON.stringify(e);localStorage.setItem("state",t)}catch(a){}}({newJob:ne.getState().newJob,categories:ne.getState().categories})}),i.a.render(r.a.createElement(c.a,{store:ne},r.a.createElement(V,null)),document.querySelector("#root"))},76:function(e,t,a){e.exports=a.p+"static/media/categoryListFile.aaaad6f5.bin"}},[[121,1,2]]]);
//# sourceMappingURL=main.7dd3f2fd.chunk.js.map